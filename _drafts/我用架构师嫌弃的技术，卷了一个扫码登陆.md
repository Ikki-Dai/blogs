# 我用架构师嫌弃的技术，卷了一个扫码登陆

Hello, 大家好，首先自我介绍一下, 我是一个CRUD 程序员。

额, 等等， 打个招呼就被卷了，是 CRUD 还是CURD ?

嗯，我默默的翻开了源码: `org.springframework.data.repository#CrudRepository<T, ID>` 丢了出去, 如果你觉的有问题的话, 去 gayhub 上给 spring 项目提个 issue 先

好了，言归正传， 下面先看需求场景

## 需求场景

最近接到一个需求，需要实现一个扫码登录的功能。刚听到产品说了一句话，架构师瞬间就把技术方案想好了。
1. 二维码本质上是一个带有 token 的地址, 客户端扫码后，依次向这个地址发送**已扫码**、**已确认**、**登陆成功**消息。 二维码本身可以在客户端生成。
2. 浏览器则不停的轮询带有这个相同 token 的地址，依次收到 **已扫码**、**已确认**、**登陆成功** 这三个消息。
3. token 是由服务器生成，并存放在redis 里，并超时时间。如果在一定的时间内用户没有扫码和确认登陆，该token 会被销毁，同时浏览器不再展示二维码，并提示用户手动刷新新的二维码。

## 问题
1. 整个业务场景前后大约也就 5 ~ 10 s 左右 
- 使用短轮询的话，假设 1秒一次 请求，大概需要耗费 5 ~10 个 请求
- 假设使用长轮询的话，每次一收到消息就响应，也要耗费3个请求
- 使用websocket 的话, 又貌似太重
2. 服务器消费

